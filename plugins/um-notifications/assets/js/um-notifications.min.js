function um_notification_flush_feed(){jQuery(".um-notification-ajax").html("")}function um_notification_show_loader(){jQuery(".um-ajax-loading-wrap").show()}function um_notification_hide_loader(){jQuery(".um-ajax-loading-wrap").hide()}function um_load_notifications(){if(!um_load_notifications.inProcess&&!um_get_notifications.inProcess)if(jQuery(".um-notification-ajax").is(":hidden"))jQuery(".um-notification-live-count").length&&(um_load_notifications.xhr=jQuery.ajax({url:wp.ajax.settings.url,type:"post",dataType:"json",data:{action:"um_notification_get_new_count",nonce:um_scripts.nonce},beforeSend:function(){um_load_notifications.inProcess=!0},complete:function(){um_load_notifications.inProcess=!1},success:function(i){if(!0===i.success){var t=jQuery(".um-notification-b, .header-notification-box"),n=i.data.new_notifications;0!==n?(t.animate({bottom:"25px"}).addClass("has-new").find(".um-notification-live-count").attr("class","um-notification-live-count count-"+n).html(i.data.new_notifications_formatted),um_notifications_recalculate_new(),um_animate_bubble()):(t.find(".um-notification-live-count").attr("class","um-notification-live-count count-0").html(0),um_notifications_recalculate_new(),1!=t.data("show-always")&&t.animate({bottom:"-220px"}).removeClass("has-new"),um_stop_bubble())}else console.error("UM: Request 'um_notification_get_new_count' failed.",i)}}));else{var i="unread"===jQuery(".um-notifications-filter.active").data("filter")?1:0,t=jQuery(".um-notification-ajax").data("time");um_load_notifications.xhr=jQuery.ajax({url:wp.ajax.settings.url,type:"post",dataType:"json",data:{action:"um_notification_check_update",unread:i,time:t,nonce:um_scripts.nonce},beforeSend:function(){um_load_notifications.inProcess=!0},complete:function(){um_load_notifications.inProcess=!1},success:function(i){if(um_notifications_filter_trigger)return um_notifications_filter_trigger=!1,void(um_load_notifications.inProcess=!1);var t=jQuery(".um-notification-ajax");if(t.data("time",i.data.time),i.data.notifications.length){for(var n=wp.template("um-notifications-list")({notifications:i.data.notifications}),o=0,a=0;a<i.data.notifications.length;a++)if(a in i.data.notifications){var e=jQuery('.um-notification[data-notification_id="'+i.data.notifications[a].id+'"');e.length&&(e.remove(),o++)}var c=parseInt(t.data("offset"))+parseInt(i.data.notifications.length)-o;t.prepend(n).data("offset",c),jQuery(".um-notifications-none").hide(),um_init_new_dropdown(),um_notifications_maybe_default_image()}}})}}function um_get_notifications(o){if(!um_get_notifications.inProcess){um_notifications_filter_trigger||um_load_notifications.inProcess&&um_load_notifications.xhr.abort();var i="unread"===jQuery(".um-notifications-filter.active").data("filter")?1:0,a=jQuery(".um-notification-ajax"),t={action:"um_get_on_load_notification",unread:i,offset:a.data("offset"),per_page:a.data("per_page"),nonce:um_scripts.nonce};o&&(t.time=a.data("time")),um_get_notifications.xhr=jQuery.ajax({url:wp.ajax.settings.url,type:"post",dataType:"json",data:t,beforeSend:function(){um_load_notifications.inProcess=!0,um_get_notifications.inProcess=!0},complete:function(){um_load_notifications.inProcess=!1,um_get_notifications.inProcess=!1,jQuery(".um-load-more-notifications").removeClass("disabled")},success:function(i){jQuery(".um-ajax-loading-wrap").hide();var t=parseInt(a.data("offset"));if(i.data.notifications.length){t+=parseInt(i.data.notifications.length);var n=wp.template("um-notifications-list")({notifications:i.data.notifications});a.append(n).data("offset",t),jQuery(".um-notifications-none").hide(),um_init_new_dropdown(),um_notifications_maybe_default_image()}else 0===a.find(".um-notification").length&&jQuery(".um-notifications-none").show();o||a.data("time",i.data.time),t>=parseInt(i.data.total)?a.siblings(".um-load-more-notifications").hide():a.siblings(".um-load-more-notifications").show()}})}}function um_animate_bubble(){jQuery(".um-notification-b").length&&jQuery(".um-notification-b").addClass("um-effect-pop")}function um_stop_bubble(){jQuery(".um-notification-b").length&&jQuery(".um-notification-b").removeClass("um-effect-pop")}function um_notification_responsive(){var i=jQuery(window).width();i<400?jQuery(".um-notification-live-feed").css({width:i+"px"}):jQuery(".um-notification-live-feed").css({width:"400px"})}function um_notification_sound(i,t){var n=jQuery(".um-notification-b, .header-notification-box");if(n.length&&n.hasClass("has-new")&&void 0!==um_notifications.unread_count&&void 0!==t.unread_count&&t.unread_count>um_notifications.unread_count){var o=new Audio(um_notifications.sound_url).play();void 0!==o&&o.then(function(i){console.log("Notification sound played!")}).catch(function(i){console.log(i.message)})}}function um_notifications_recalculate_new(){jQuery(".um-notification-live-count").length&&(0<parseInt(jQuery(".um-notification-live-count").html())?jQuery(".um-notification-live-count").show():jQuery(".um-notification-live-count").hide())}function um_notifications_maybe_default_image(){jQuery(".um-notification-photo").on("error",function(){jQuery(this).attr("src",jQuery(this).data("default"))})}function um_notifications_init_interval(){0!==parseInt(um_notifications.timer)&&(um_notifications_interval_id=setInterval(um_load_notifications,parseInt(um_notifications.timer)))}var um_notifications_interval_id,um_notifications_filter_trigger=!1;document.addEventListener("visibilitychange",function(){document.hidden?clearInterval(um_notifications_interval_id):um_notifications_init_interval()}),jQuery(window).on("resize",function(){um_notification_responsive()}),jQuery(document).ready(function(){if(jQuery(document.body).on("click",".um-notification-i-close",function(i){i.preventDefault(),jQuery(".um-notification-live-feed").hide().find(".um-notification-ajax").data("offset",0).html("")}),um_notifications_recalculate_new(),um_notifications_init_interval(),jQuery(".um-notification-ajax").is(":visible")&&um_get_notifications(),parseInt(um_notifications.sound)&&um_notifications.sound_url&&jQuery(document).on("um_notification_refresh_count",um_notification_sound),jQuery(document.body).on("click",".um-notifications-mark-all-read",function(){wp.ajax.send("um_notification_mark_all_as_read",{data:{nonce:um_scripts.nonce},success:function(i){"unread"===jQuery(".um-notifications-filter.active").data("filter")?(jQuery(".um-notification-ajax").html("").data("offset",0),jQuery(".um-notifications-none").show(),jQuery(".um-load-more-notifications").hide()):jQuery(".um-notification.unread").each(function(){jQuery(this).removeClass("unread").addClass("read")})},error:function(i){console.log(i)}})}),jQuery(document.body).on("click",".um-notifications-clear-all",function(){wp.ajax.send("um_notification_delete_all_log",{data:{nonce:um_scripts.nonce},success:function(i){jQuery(".um-notification-ajax").html("").data("offset",0),jQuery(".um-notifications-none").show(),jQuery(".um-load-more-notifications").hide()},error:function(i){console.log(i)}})}),jQuery(document.body).on("click",".um-notifications-filter",function(){um_get_notifications.inProcess||(jQuery(".um-ajax-loading-wrap").show(),jQuery(".um-notifications-none").hide(),jQuery(".um-load-more-notifications").hide(),jQuery(".um-notification-ajax").html("").data("offset",0),jQuery(".um-notifications-filter").removeClass("active"),jQuery(this).addClass("active"),um_notifications_filter_trigger=!0,um_get_notifications())}),jQuery(document.body).on("click",".um-notification .um-notification-link",function(){var n=jQuery(this),i=n.data("notification_id");wp.ajax.send("um_notification_mark_as_read",{data:{notification_id:i,nonce:um_scripts.nonce},success:function(i){var t=n.data("notification_uri");t&&(window.location=t)},error:function(i){console.log(i)}})}),jQuery(document.body).on("click",'.um-new-dropdown[data-element=".um-notification-actions"] li a',function(i){i.preventDefault();var t=jQuery(this).attr("class"),n=jQuery(this).data("notification_id"),o=jQuery("#notification-"+n),a="unread"===o.parents(".um-notification-shortcode").find(".um-notifications-filter.active").data("filter")?1:0,e=o.parents(".um-notification-ajax"),c=parseInt(e.data("offset"));switch(t){case"um-read-notification":wp.ajax.send("um_notification_mark_as_read",{data:{notification_id:n,unread:a,offset:c,time:e.data("time"),nonce:um_scripts.nonce},success:function(i){if(a){e.data("offset",c-1);var t=parseInt(e.data("offset"));if(i.notifications.length){t+=parseInt(i.notifications.length);var n=wp.template("um-notifications-list")({notifications:i.notifications});e.append(n).data("offset",t),jQuery(".um-notifications-none").hide(),um_init_new_dropdown(),um_notifications_maybe_default_image()}t>=parseInt(i.total)?e.siblings(".um-load-more-notifications").hide():e.siblings(".um-load-more-notifications").show(),o.remove(),0===e.find(".um-notification").length&&e.siblings(".um-notifications-none").show()}else o.removeClass("unread").addClass("read"),o.find(".um-notification-actions .um-new-dropdown .um-read-notification").parent().remove()},error:function(i){console.log(i)}});break;case"um-remove-notification":wp.ajax.send("um_notification_delete_log",{data:{notification_id:n,unread:a,offset:c,time:e.data("time"),nonce:um_scripts.nonce},success:function(i){if(e.data("offset",c-1),i.notifications.length){var t=(c=parseInt(e.data("offset")))+parseInt(i.notifications.length),n=wp.template("um-notifications-list")({notifications:i.notifications});e.append(n).data("offset",t),jQuery(".um-notifications-none").hide(),um_init_new_dropdown(),um_notifications_maybe_default_image(),t>=parseInt(i.total)?e.siblings(".um-load-more-notifications").hide():e.siblings(".um-load-more-notifications").show()}o.remove(),0===e.find(".um-notification").length&&e.siblings(".um-notifications-none").show()},error:function(i){console.log(i)}});break;case"um-disable-notification":var u=jQuery(this).data("type");wp.ajax.send("um_notification_change_notifications_prefs",{data:{notification_type:u,nonce:um_scripts.nonce},success:function(i){jQuery("#notification-"+n).find(".um-notification-actions .um-new-dropdown .um-disable-notification").parent().remove()},error:function(i){console.log(i)}})}return!1}),jQuery(".um-notification-b").length&&(jQuery(".um-notification-b").hasClass("left")?jQuery(".um-notification-live-feed").css({left:"0"}):jQuery(".um-notification-live-feed").css({right:"0"}),jQuery(document.body).on("click",".um-notification-b",function(){var i=jQuery(".um-notification-live-feed");i.find(".um-notification-ajax").html("").data("offset",0),um_notification_show_loader(),i.is(":hidden")?(um_load_notifications.inProcess&&um_load_notifications.xhr.abort(),um_get_notifications.inProcess&&um_get_notifications.xhr.abort(),um_notification_responsive(),i.show(),um_get_notifications(),jQuery(".um-notification-live-count").length&&(jQuery(".um-notification-live-count").attr("class","um-notification-live-count count-0").html(0),um_notifications_recalculate_new())):i.hide()})),jQuery(document.body).on("click",".um-load-more-notifications",function(i){i.preventDefault(),jQuery(this).hasClass("disabled")||(jQuery(this).addClass("disabled"),um_get_notifications(!0))}),jQuery(".um-notification-live-feed").length){var i=0;jQuery(".um-notification-live-feed").scroll(function(){i=jQuery(this).scrollTop()}),jQuery(document.body).on("click",".um-notification-actions-a",function(){jQuery(".um-new-dropdown").css("marginTop",i)})}});