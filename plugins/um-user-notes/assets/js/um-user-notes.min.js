jQuery(document).ready(function(i){i.fn.um_serializeFiles=function(){var e=i(this),a=new FormData,t=e.serializeArray();return i.each(e.find('input[type="file"]'),function(e,n){i.each(i(n)[0].files,function(e,t){a.append(n.name,t)})}),i.each(t,function(e,t){a.append(t.name,t.value)}),a},i(document.body).on("change","#um_notes_image_control",function(e){var n=i(this).parents(".um_notes_image_label"),t=new FileReader;t.onload=function(e){var t=e.target.result;n.css("background-image",'url("'+t+'")'),n.css("background-size","cover")},this.files.length&&(t.readAsDataURL(this.files[0]),i("#um_notes_clear_image").css("display","block"),n.find(".um_notes_image_label_text").html(n.find("> span").data("edit_photo")))}),i(document.body).on("click","#um_notes_add_btn",function(e){e.preventDefault();var n=i(this);if(!n.hasClass("busy")){tinyMCE.triggerSave();var a=n.html(),o=i("form#um-user-notes-add");n.html('<i class="um-user-notes-ajax-loading"></i>').addClass("busy"),wp.ajax.send({data:o.um_serializeFiles(),cache:!1,contentType:!1,processData:!1,success:function(e){n.html(a).removeClass("busy"),o.trigger("reset"),i("label.um_notes_image_label").css("background-image","none"),i("#um_notes_clear_image").hide();var t=o.find(".form-response");t.html('<p style="background:green;padding:10px;color:#fff;">'+e.display+"</p>"),t.find(".um_note_read_more").trigger("click")},error:function(e){console.log(e),n.html(a).removeClass("busy"),o.find(".form-response").html('<div style="background:red;padding:10px;color:#fff;">'+e+"</div><br/>")}})}}),i(document.body).on("click","#um_notes_back_btn",function(e){e.preventDefault();var t=i(this);if(!t.hasClass("busy")){t.addClass("busy").html('<i class="um-user-notes-ajax-loading"></i>');var n=i("body"),a=n.find(".um-notes-modal"),o=a.find(".um_notes_modal_content");o.html('<h1 style="margin-top:100px;text-align:center"><i class="um-user-notes-ajax-loading"></i></h1>'),a.css("display","block"),n.addClass("um_notes_overlay"),wp.ajax.send("um_notes_view",{data:{note:t.attr("data-id")},success:function(e){o.html(e)},error:function(e){console.log(e)}})}}),i(document.body).on("click","#um_notes_update_btn",function(e){e.preventDefault();var t=i(this);if(!t.hasClass("busy")){tinyMCE.triggerSave(),t.addClass("busy").html('<i class="um-user-notes-ajax-loading"></i>');var n=i("form#um-user-notes-edit");wp.ajax.send("um_notes_update",{data:n.um_serializeFiles(),cache:!1,contentType:!1,processData:!1,success:function(e){n.find(".form-response").html('<p style="background:green;padding:10px;color:#fff;">'+wp.i18n.__("Note successfully updated.","um-user-notes")+"</p>"),setTimeout(function(){i("#um_notes_back_btn").trigger("click")},2e3),i(".um-notes-modal").addClass("updated")},error:function(e){console.log(e),n.find(".form-response").html('<p style="background:red;padding:10px;color:#fff;">'+e+"</p>")}})}}),i(document.body).on("click",".um_note_read_more",function(e){e.preventDefault();var t=i(this),n=i("body"),a=n.find(".um-notes-modal"),o=a.find(".um_notes_modal_content");o.html('<h1 style="margin-top:100px;text-align:center"><i class="um-user-notes-ajax-loading"></i></h1>'),a.css("display","block"),n.addClass("um_notes_overlay"),wp.ajax.send("um_notes_view",{data:{note:t.attr("data-id")},success:function(e){o.html(e)},error:function(e){o.html(e)}})}),i(document.body).on("click","#um_notes_modal_close",function(e){e.preventDefault();var t=i(this),n=t.parents(".um-notes-modal"),a=n.find(".um_notes_modal_content");if(n.hasClass("updated"))location.reload();else{var o=t.data("close");""!==o&&window.location.href!==o?document.location.href=o:(a.html(""),n.css("display","none"),wp.editor.remove("note_content"),i("body").removeClass("um_notes_overlay"))}}).on("click","div.um-notes-modal",function(e){var t=jQuery(e.target);t.is("div.um-notes-modal")&&t.find("#um_notes_modal_close").trigger("click")}),i(document.body).on("click",".um_notes_delete_note",function(e){e.preventDefault();var t=i(this);t.html();if(!t.hasClass("busy")){var n=t.attr("data-id"),a=t.attr("data-nonce");confirm(wp.i18n.__("Want to delete note?","um-user-notes"))&&(t.addClass("busy"),t.html('<i class="um-user-notes-ajax-loading"></i>'),wp.ajax.send("um_notes_delete",{data:{post_id:n,_nonce:a},success:function(e){location.reload()},error:function(e){console.log(e)}}))}}),i(document.body).on("click",".um_notes_edit_note",function(e){e.preventDefault();var t=i(this);if(wp.editor.remove("note_content_edit"),!t.hasClass("busy")){wp.editor.remove("note_content"),t.addClass("busy").html('<i class="um-user-notes-ajax-loading"></i>');var n=t.attr("data-id"),a=t.attr("data-nonce"),o=i("body").find(".um-notes-modal").find(".um_notes_modal_content");o.html('<h1 style="margin-top:100px;text-align:center"><i class="um-user-notes-ajax-loading large"></i></h1>'),wp.ajax.send("um_notes_edit",{data:{post_id:n,_nonce:a},success:function(e){o.html(e),wp.editor.initialize("note_content_edit",{tinymce:{wpautop:!0,plugins:"charmap colorpicker compat3x directionality fullscreen hr image lists media paste tabfocus textcolor wordpress wpautoresize wpdialogs wpeditimage wpemoji wpgallery wplink wptextpattern wpview",toolbar1:"formatselect bold italic | bullist numlist | blockquote | alignleft aligncenter alignright | link unlink | wp_more | spellchecker | fullscreen | wp_adv",toolbar2:"strikethrough | hr | forecolor | pastetext | removeformat | charmap | outdent | indent | undo | redo | wp_help"},quicktags:!0})},error:function(e){console.log(e)}})}}),i(document.body).on("click","#um_notes_clear_image",function(e){e.preventDefault();var t=i(this),n=(t.attr("data-id"),t.attr("data-mode"),t.parents("form"));i(".um_notes_image_label").css("background-image","none"),i(".um_notes_image_label .um_notes_image_label_text").html(i(".um_notes_image_label > span").data("add_photo")),i("#um_notes_image_control").val(null),n.find('[name="thumbnail_id"]').val(""),t.css("display","none")}),i(document.body).on("click","#um-notes-load-more-btn",function(){var t=i(this),e=t.data("per_page"),n=t.data("profile"),a=t.data("nonce"),o=t.data("page"),s=t.html();t.html('<i class="um-user-notes-ajax-loading"></i>'),wp.ajax.send("um_notes_load_more",{data:{per_page:e,offset:e*o,profile:n,_nonce:a},success:function(e){!0!==e.loadmore&&t.hide(),"empty"!==e.html&&(i("body").find(".um-notes-holder").append(e.html),t.data("page",parseInt(o)+1).html(s))},error:function(e){console.log(e)}})})});